This is based on the Mehdi's sequential mlp code.
